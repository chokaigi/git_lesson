# 第2回Git勉強会

## こんなときどうする編
今までの説明以外で業務上起こりうるよくあるパターンをやってみましょう

## 1.変更をなかったコトにしたい
どんなケースか  
「前回のコミットからソースをいじったけどコミットせず元に戻したい」  
・git checkout .   
これで現在のディレクトリ下のファイルを戻せます。  

そのほかにも指定ファイルを元に戻す事が可能です  
git checkout [ファイル名]  

```
$ vi ccc.txt
「作業：viで新規ファイルを作成」
$ ls
ccc.txt
$ git add ccc,txt
$ git commit -m test
「作業：新規ファイルのcommit」

$ vi ccc.txt
「作業：viでファイルの内容を修正」

$ git diff
diff --git a/ccc.txt b/ccc.txt
index 259b241..543209f 100644
--- a/ccc.txt
+++ b/ccc.txt
@@ -1,2 +1,4 @@
 test
 test1
+test
+test1
warning: LF will be replaced by CRLF in ccc.txt.
The file will have its original line endings in your working directory.
$ git checkout ccc.txt
「作業：修正したファイルを元に戻す」

$ git diff
```

## 2.コミット済みのスナップショットを元にもどす
コミットしたけど仕様上不要になって何個か前のコミットまで戻したいケース  
git reset [CommitID]  
※指定するCommitIDは戻したい履歴まで。その次以降はCommit履歴が消えます)    
で  
![reset](images/gitreset01.png "reset実行イメージ")

```
$git reset (2のCommitID)  
```
で２まで取り消します。（３の履歴はツリー上からなくなります）
注意してほしいのはファイル自体は変更されません。  
Commitしていない変更がある状態に戻ります。  
(ファイルも戻したい場合はreset後にcheckoutを使ってください)


図の流れのコマンドが以下になります
```
hoge@hogewin ~/gitwork/test/gitReset
$ git init
Initialized empty Git repository in C:/Users/hoge/gitwork/test/gitReset/.git/

※No１コミット対象としてa.txtファイルを追加します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ vi a.txt

※statusコマンドで確認するとa.txtが未ステージング状態です。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status
On branch master

Initial commit

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        a.txt

nothing added to commit but untracked files present (use "git add" to track)

※ a.txtファイルをaddコマンドでステージングします。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git add a.txt
The file will have its original line endings in your working directory.

※再度statusコマンドでみるとステージングされていて未commit状態です
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status
On branch master

Initial commit

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)

        new file:   a.txt

※commitします（メッセージをNo1 commit）
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git commit
[master (root-commit) 80e6ed3] No1 commit

 1 file changed, 1 insertion(+)
 create mode 100644 a.txt

※logコマンドでcommit履歴を確認します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git log
commit 80e6ed33704d72b595a6283574cba78c4cf1de08
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:13:06 2016 +0900

    No1 commit
※続いてNo２コミット対象としてa.txtファイルを編集します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ vi a.txt

※合わせてNo２コミット対象としてb.txtファイルを追加します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ vi b.txt

※statusコマンドで確認するとa.txtの修正とb.txtが未ステージング状態です。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   a.txt

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        b.txt

no changes added to commit (use "git add" and/or "git commit -a")

※ a.txtファイルをaddコマンドでステージングします。(修正であってもaddします)
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git add a.txt

※ b.txtファイルをaddコマンドでステージングします。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git add b.txt

※再度statusコマンドでみるとステージングされていて未commit状態です
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status

On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   a.txt
        new file:   b.txt


※commitします（メッセージをNo2 commit）
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git commit

[master
d3adb45] No2 commit
 2 files changed, 2 insertions(+)
 create mode 100644 b.txt

※logコマンドでcommit履歴を確認します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git log
commit d3adb45b9acd825f48507e150720a9650972308d
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:15:45 2016 +0900

    No2 commit

commit 80e6ed33704d72b595a6283574cba78c4cf1de08
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:13:06 2016 +0900

    No1 commit

※続いてNo３コミット対象としてb.txtファイルを編集します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ vi b.txt

※合わせてNo３コミット対象としてc.txtファイルを追加します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ vi c.txt

※diffコマンドで差分を確認します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git diff
diff --git a/b.txt b/b.txt
index 180cf83..021c3f5 100644
--- a/b.txt
+++ b/b.txt
@@ -1 +1,2 @@
 test2
+test02

※statusコマンドで確認するとb.txtの修正とc.txtが未ステージング状態です。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   b.txt

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        c.txt

no changes added to commit (use "git add" and/or "git commit -a")

※ b.txtファイルをaddコマンドでステージングします。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git add b.txt

※ c.txtファイルをaddコマンドでステージングします。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git add c.txt

※statusコマンドで確認するとb.txtの修正とc.txtがステージング状態です。
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status

On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   b.txt
        new file:   c.txt


※commitします（メッセージをNo3 commit）
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git commit

[master
4a5ad29] No3 commit
 2 files changed, 2 insertions(+)
 create mode 100644 c.txt

※logコマンドでcommit履歴を確認します
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git log
commit 4a5ad2979e6e004248d06e98128f34b787031ada
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:18:14 2016 +0900

    No3 commit

commit d3adb45b9acd825f48507e150720a9650972308d
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:15:45 2016 +0900

    No2 commit

commit 80e6ed33704d72b595a6283574cba78c4cf1de08
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:13:06 2016 +0900

    No1 commit

※resetコマンドでNo2のCommitまで戻します。（＝No3のCommitをなかったことにする）
※戻す先のcommitIDを指定します（今回の場合No2です）
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git reset d3adb45b9acd825f48507e150720a9650972308d

Unstaged changes after reset:
M       b.txt

※ファイルをみるとNo3に追加したファイルや修正は残っています
※resetコマンドはgit環境へのResetなのでファイル自体は変更しません
hoge@hogewin ~/gitwork/test/gitReset (master)
$ ls
a.txt  b.txt  c.txt

※diffコマンドやstatusコマンドでみるとNo3分のcommit作業前（add前）の状態です
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git diff
diff --git a/b.txt b/b.txt
index 180cf83..021c3f5 100644
--- a/b.txt
+++ b/b.txt
@@ -1 +1,2 @@
 test2
+test02

hoge@hogewin ~/gitwork/test/gitReset (master)
$ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   b.txt

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        c.txt

no changes added to commit (use "git add" and/or "git commit -a")

※logコマンドでみるとNo3のcommitがなくなっています
hoge@hogewin ~/gitwork/test/gitReset (master)
$ git log
commit d3adb45b9acd825f48507e150720a9650972308d
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:15:45 2016 +0900

    No2 commit

commit 80e6ed33704d72b595a6283574cba78c4cf1de08
Author: Hoge Hogeyama <hoge@gmail.com>
Date:   Tue Jun 28 20:13:06 2016 +0900

    No1 commit

```


## 演習問題
1. 任意のファイルを編集した後、編集する前の状態に戻してください。
* 任意のファイルを編集し、任意のコメントを付けてコミット後、コミットしたコメントを「コメントを修正しました」に修正してください。
